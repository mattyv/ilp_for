# ILP_FOR Library Function Pairings
# This file defines semantic relationships between functions that must be used together.
#
# Format:
# [[pairing]]
# opener = "function_name"      # The function that initiates/acquires
# closer = "function_name"      # The function that completes/releases
# required = true/false         # Whether the closer MUST be called
# evidence = "explanation"      # Why these are paired

[metadata]
layer = "ilp_for"
version = "1.0.0"

# =============================================================================
# Loop Start/End Pairs (REQUIRED)
# Every ILP_FOR* macro MUST be closed with ILP_END or ILP_END_RETURN
# =============================================================================

[[pairing]]
opener = "ILP_FOR"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_T"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_T (typed) opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_AUTO"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_AUTO opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_T_AUTO"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_T_AUTO opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_RANGE"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_RANGE opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_RANGE_T"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_RANGE_T opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_RANGE_AUTO"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_RANGE_AUTO opens a loop block that must be closed with ILP_END"

[[pairing]]
opener = "ILP_FOR_RANGE_T_AUTO"
closer = "ILP_END"
required = true
evidence = "Loop structure: ILP_FOR_RANGE_T_AUTO opens a loop block that must be closed with ILP_END"

# =============================================================================
# Loop Start with Early Return Pairs
# ILP_FOR* can also be closed with ILP_END_RETURN for early return patterns
# =============================================================================

[[pairing]]
opener = "ILP_FOR"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_T"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_T can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_AUTO"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_AUTO can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_T_AUTO"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_T_AUTO can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_RANGE"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_RANGE can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_RANGE_T"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_RANGE_T can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_RANGE_AUTO"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_RANGE_AUTO can use ILP_END_RETURN for early return pattern"

[[pairing]]
opener = "ILP_FOR_RANGE_T_AUTO"
closer = "ILP_END_RETURN"
required = false
evidence = "Loop structure: ILP_FOR_RANGE_T_AUTO can use ILP_END_RETURN for early return pattern"

# =============================================================================
# Idiom Templates
# Common usage patterns showing correct composition
# =============================================================================

[[idiom]]
name = "ilp_for_basic"
participants = ["ILP_FOR", "ILP_END"]
template = '''
ILP_FOR(int, i, 0, n, N) {
    // loop body - processes N iterations in parallel
} ILP_END
'''

[[idiom]]
name = "ilp_for_typed"
participants = ["ILP_FOR_T", "ILP_END"]
template = '''
ILP_FOR_T(size_t, i, start, end, N) {
    // loop body with explicit type for iterator
} ILP_END
'''

[[idiom]]
name = "ilp_for_auto"
participants = ["ILP_FOR_AUTO", "ILP_END"]
template = '''
ILP_FOR_AUTO(i, 0, n, N) {
    // loop body with auto-deduced iterator type
} ILP_END
'''

[[idiom]]
name = "ilp_for_range"
participants = ["ILP_FOR_RANGE", "ILP_END"]
template = '''
ILP_FOR_RANGE(int, elem, container, N) {
    // iterate over container elements
} ILP_END
'''

[[idiom]]
name = "ilp_for_early_return"
participants = ["ILP_FOR", "ILP_RETURN", "ILP_END_RETURN"]
template = '''
ILP_FOR(int, i, 0, n, N) {
    if (condition) {
        ILP_RETURN(value);  // early return from loop
    }
} ILP_END_RETURN
'''

[[idiom]]
name = "ilp_for_break_continue"
participants = ["ILP_FOR", "ILP_BREAK", "ILP_CONTINUE", "ILP_END"]
template = '''
ILP_FOR(int, i, 0, n, N) {
    if (skip_condition) {
        ILP_CONTINUE;  // skip to next iteration
    }
    if (stop_condition) {
        ILP_BREAK;  // exit loop early
    }
} ILP_END
'''
